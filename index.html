<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Uploader Cloudinary</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
  <style>
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(100%); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes slideOutRight {
      from { opacity: 1; transform: translateX(0); }
      to { opacity: 0; transform: translateX(100%); }
    }
    .animate-slideInRight { animation: slideInRight 0.4s ease-out; }
    .animate-slideOutRight { animation: slideOutRight 0.4s ease-in forwards; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 shadow-md sticky top-0 z-10">
    <div class="max-w-5xl mx-auto flex justify-between items-center p-4">
      <h1 class="text-lg font-bold text-green-600 dark:text-green-400">üìÇ Cloudinary Uploader</h1>
      <div class="flex gap-2 items-center">
        <label class="flex items-center gap-1 text-sm">
          <input type="checkbox" id="toggleSound" class="rounded" checked /> üîä Suara
        </label>
        <button id="toggleTheme" class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 text-sm">
          üåô / ‚òÄÔ∏è
        </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 flex items-center justify-center p-6">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 max-w-lg w-full border border-gray-200 dark:border-gray-700">
      <h2 class="text-xl font-semibold mb-4">Upload Foto</h2>

      <!-- Dropzone -->
      <div id="dropZone" class="border-2 border-dashed border-gray-400 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer hover:border-green-400 transition">
        <p class="text-gray-500 dark:text-gray-400">Drag & Drop gambar di sini atau klik untuk memilih file</p>
        <input id="fileInput" type="file" accept="image/*" class="hidden" />
      </div>

      <!-- Preview -->
      <div id="previewContainer" class="hidden mt-4">
        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Preview:</p>
        <img id="previewImage" class="w-full rounded-lg shadow border border-gray-300 dark:border-gray-700" alt="Preview gambar" />
      </div>

      <!-- Input nama file -->
      <input id="fileName" type="text" placeholder="Nama file (opsional)"
        class="w-full border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 rounded-lg px-3 py-2 text-sm mt-4 focus:outline-none focus:ring focus:ring-green-500" />

      <!-- Tombol Upload -->
      <button id="uploadBtn" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg w-full mt-4">
        ‚¨ÜÔ∏è Upload
      </button>

      <!-- Progress Bar -->
      <div id="progressContainer" class="hidden mt-4">
        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4">
          <div id="progressBar" class="bg-green-600 h-4 rounded-full text-xs text-white text-center" style="width: 0%">0%</div>
        </div>
      </div>

      <!-- Hasil -->
      <div id="result" class="mt-6 text-sm"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-100 dark:bg-gray-800 text-center text-sm p-4 border-t border-gray-200 dark:border-gray-700">
    Dibuat dengan ‚ù§Ô∏è untuk demo uploader
  </footer>

  <!-- Toast Container -->
  <div id="toastContainer" class="fixed bottom-4 right-4 space-y-2 z-50 flex flex-col items-end"></div>

  <!-- Suara Notifikasi -->
  <audio id="soundSuccess" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
  <audio id="soundError" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
  <audio id="soundWarning" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const fileNameInput = document.getElementById("fileName");
    const previewContainer = document.getElementById("previewContainer");
    const previewImage = document.getElementById("previewImage");
    const result = document.getElementById("result");
    const uploadBtn = document.getElementById("uploadBtn");
    const toggleBtn = document.getElementById("toggleTheme");
    const toggleSound = document.getElementById("toggleSound");
    const html = document.documentElement;
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");

    // Suara notifikasi
    const soundSuccess = document.getElementById("soundSuccess");
    const soundError = document.getElementById("soundError");
    const soundWarning = document.getElementById("soundWarning");

    let soundEnabled = true;
    toggleSound.addEventListener("change", () => {
      soundEnabled = toggleSound.checked;
      localStorage.sound = soundEnabled ? "on" : "off";
    });
    if (localStorage.sound === "off") {
      toggleSound.checked = false;
      soundEnabled = false;
    }

    // Cloudinary config (ganti sesuai akunmu)
    const CLOUD_NAME = "ddbqhpuoz";
    const UPLOAD_PRESET = "upload_Jhon";

    let selectedFile = null;

    // === THEME HANDLER ===
    if (localStorage.theme === "dark" || 
       (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      html.classList.add("dark");
    } else {
      html.classList.remove("dark");
    }

    toggleBtn.addEventListener("click", () => {
      html.classList.toggle("dark");
      localStorage.theme = html.classList.contains("dark") ? "dark" : "light";
    });

    // === UPLOAD HANDLER ===
    function showPreview(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        previewContainer.classList.remove("hidden");
      };
      reader.readAsDataURL(file);
    }

    dropZone.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", () => {
      if (fileInput.files.length > 0) {
        selectedFile = fileInput.files[0];
        showPreview(selectedFile);
      }
    });

    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("border-green-400", "bg-gray-100", "dark:bg-gray-700");
    });
    dropZone.addEventListener("dragleave", () => {
      dropZone.classList.remove("border-green-400", "bg-gray-100", "dark:bg-gray-700");
    });
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("border-green-400", "bg-gray-100", "dark:bg-gray-700");
      if (e.dataTransfer.files.length > 0) {
        selectedFile = e.dataTransfer.files[0];
        showPreview(selectedFile);
      }
    });

    // === TOAST FUNCTION ===
    function showToast(message, type = "success") {
      const toast = document.createElement("div");
      let bgColor = "bg-green-600";
      let icon = "‚úî";
      let sound = soundSuccess;

      if (type === "error") { bgColor = "bg-red-600"; icon = "‚úñ"; sound = soundError; }
      if (type === "warning") { bgColor = "bg-yellow-500 text-black"; icon = "‚ö†"; sound = soundWarning; }

      toast.className =
        `flex items-center gap-2 px-4 py-2 rounded shadow text-sm animate-slideInRight text-white ${bgColor}`;
      toast.innerHTML = `<span>${icon}</span> <span>${message}</span> <button class=\"ml-3 text-lg leading-none\">‚úñ</button>`;

      const closeBtn = toast.querySelector("button");
      closeBtn.addEventListener("click", () => {
        toast.classList.remove("animate-slideInRight");
        toast.classList.add("animate-slideOutRight");
        setTimeout(() => toast.remove(), 400);
      });

      document.getElementById("toastContainer").appendChild(toast);

      // Mainkan suara jika aktif
      if (soundEnabled) {
        sound.currentTime = 0;
        sound.play();
      }

      setTimeout(() => {
        toast.classList.remove("animate-slideInRight");
        toast.classList.add("animate-slideOutRight");
        setTimeout(() => toast.remove(), 400);
      }, 3000);
    }

    uploadBtn.addEventListener("click", () => {
      if (!selectedFile) return alert("Pilih atau drag file dulu");

      const customName = fileNameInput.value.trim();
      result.innerHTML = "";
      progressContainer.classList.remove("hidden");
      progressBar.style.width = "0%";
      progressBar.textContent = "0%";

      const formData = new FormData();
      formData.append("file", selectedFile);
      formData.append("upload_preset", UPLOAD_PRESET);
      if (customName) formData.append("public_id", customName);

      const xhr = new XMLHttpRequest();
      xhr.open("POST", `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, true);

      xhr.upload.addEventListener("progress", (e) => {
        if (e.lengthComputable) {
          const percent = Math.round((e.loaded * 100) / e.total);
          progressBar.style.width = percent + "%";
          progressBar.textContent = percent + "%";
        }
      });

      xhr.onload = async () => {
        progressBar.style.width = "100%";
        progressBar.textContent = "100%";

        const data = JSON.parse(xhr.responseText);
        if (data.secure_url) {
          const directUrl = data.secure_url;
          const bbCode = `[img]${directUrl}[/img]`;
          const markdown = `![image](${directUrl})`;
          const htmlTagDisplay = `&lt;img src="${directUrl}" alt="image"&gt;`;
          const htmlTagCopy = `<img src="${directUrl}" alt="image">`;

          const encDirect = encodeURIComponent(directUrl);
          const encBb = encodeURIComponent(bbCode);
          const encMd = encodeURIComponent(markdown);
          const encHtml = encodeURIComponent(htmlTagCopy);

          await navigator.clipboard.writeText(directUrl);

          result.innerHTML = `
            <p class="text-green-500 mt-4">‚úÖ Upload berhasil!</p>

            <p class="mt-3">üîó Direct URL:</p>
            <div class="flex items-center gap-2 mt-1">
              <a href="${directUrl}" target="_blank" class="text-green-600 dark:text-green-400 underline break-all flex-1">${directUrl}</a>
              <button class="copyBtn px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-500" data-text="${encDirect}">Copy</button>
            </div>

            <p class="mt-3">üìÑ BBCode:</p>
            <div class="flex items-center gap-2 mt-1">
              <code class="bg-gray-100 dark:bg-gray-900 px-2 py-1 rounded text-xs break-all flex-1 text-green-600 dark:text-green-300">${bbCode}</code>
              <button class="copyBtn px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-500" data-text="${encBb}">Copy</button>
            </div>

            <p class="mt-3">üìÑ Markdown:</p>
            <div class="flex items-center gap-2 mt-1">
              <code class="bg-gray-100 dark:bg-gray-900 px-2 py-1 rounded text-xs break-all flex-1 text-green-600 dark:text-green-300">${markdown}</code>
              <button class="copyBtn px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-500" data-text="${encMd}">Copy</button>
            </div>

            <p class="mt-3">üìÑ HTML &lt;img&gt;:</p>
            <div class="flex items-center gap-2 mt-1">
              <code class="bg-gray-100 dark:bg-gray-900 px-2 py-1 rounded text-xs break-all flex-1 text-green-600 dark:text-green-300">${htmlTagDisplay}</code>
              <button class="copyBtn px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-500" data-text="${encHtml}">Copy</button>
            </div>

            <p class="text-xs text-gray-500 mt-3">(Direct URL sudah otomatis dicopy ke clipboard)</p>
          `;

          document.querySelectorAll(".copyBtn").forEach(btn => {
            btn.addEventListener("click", async () => {
              const encoded = btn.getAttribute("data-text");
              const text = decodeURIComponent(encoded);
              await navigator.clipboard.writeText(text);
              btn.textContent = "Copied!";
              setTimeout(() => btn.textContent = "Copy", 2000);
            });
          });

          // ‚úÖ Show toast sukses (hijau + ‚úî)
          showToast("Upload berhasil & link dicopy", "success");

          // üî• Auto-hide progress bar & reset form
          setTimeout(() => {
            progressContainer.classList.add("hidden");
            fileInput.value = "";
            fileNameInput.value = "";
            previewContainer.classList.add("hidden");
            previewImage.src = "";
            selectedFile = null;
          }, 2000);

        } else {
          result.innerHTML = `<p class="text-red-500 mt-4">‚ùå Upload gagal!</p>`;
          showToast("Upload gagal", "error");
        }
      };

      xhr.onerror = () => {
        result.innerHTML = `<p class="text-red-500 mt-4">‚ö†Ô∏è Terjadi error saat upload.</p>`;
        showToast("Terjadi error saat upload", "warning");
      };

      xhr.send(formData);
    });
  </script>
</body>
</html>